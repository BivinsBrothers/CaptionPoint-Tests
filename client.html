<!doctype html>
<html>
  <head>
    <title>Client | CaptionPoint</title>
    <link rel="manifest" href="/client_manifest.json">
    <link rel="stylesheet" type="text/css" href="css/style.css">
  </head>
  <body>
    <textarea id="source"></textarea>
    <ul id="messages"></ul>

    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/remark.js"></script>
    <script>
      var slideshow = remark.create({
        sourceUrl: 'will.md',
        ratio: '16:9',
        navigation: {
          scroll: false,
        },
      });

      $(document).ready(function() {
        var socket = io();

        socket.on('redirect', function(slideshowState){
          console.log('Redirecting to slide: ' + slideshowState.slideNumber);
          slideshow.gotoSlide(slideshowState.slideNumber);
        });

        socket.on('blackout', function(slideshowState){
          console.log('Triggering blackout event: ' + slideshowState.blackout);
          slideshow.toggleBlackout();
        });

        socket.on('fullscreen', function(slideshowState){
          console.log('Triggering fullscreen event: ' + slideshowState.fullscreen);
          slideshow.toggleFullscreen();
        });

        socket.on('statusUpdate', function(slideshowState) {
          console.log('Receiving status update: ' + JSON.stringify(slideshowState));
          var currentSlideNumber = Number.parseInt(window.location.href.split('#')[1]);

          if(currentSlideNumber !== slideshowState.slideNumber) {
            slideshow.gotoSlide(slideshowState.slideNumber);
          }

          if(slideshowState.blackout) {
            slideshow.toggleBlackout();
          }

          if(slideshowState.fullscreen) {
            slideshow.toggleFullscreen();
          }
        });
      });
    </script>
  </body>
</html>
